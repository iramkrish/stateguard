#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

msg=$(cat "$1")

echo ""
echo "ğŸ“¬ [HUSKY] Commit message hook engaged!"
echo "ğŸ•µï¸  Validating commit message: \"$msg\""
echo ""


if echo "$msg" | grep -Ei 'fix typo|wip|stuff'; then
  echo "ğŸš¨ Suspiciously lazy commit message detected!"
  echo "ğŸµ You've been Rickrolled!"

  # Cross-platform Rickroll
  case "$(uname)" in
    Darwin*) open "https://www.youtube.com/watch?v=dQw4w9WgXcQ" ;;
    Linux*)  xdg-open "https://www.youtube.com/watch?v=dQw4w9WgXcQ" ;;
    CYGWIN*|MINGW*|MSYS*) start "https://www.youtube.com/watch?v=dQw4w9WgXcQ" ;;
  esac

  exit 1
fi

echo "ğŸ“ Running commitlint..."
npx --no -- commitlint --edit "$1" || {
  echo "ğŸ›‘ Commit message failed linting. Please fix it."
  exit 1
}

echo ""
echo "âœ… Commit message passed all checks. Rock on! ğŸ¤˜"
