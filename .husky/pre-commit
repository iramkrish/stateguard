#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo ""
echo "ðŸ¶ [HUSKY] Pre-commit hook activated!"
echo "ðŸ” Running test, lint, secrets check, and fortune wisdom..."
echo ""

if git diff --cached | grep -Ei 'apikey|secret|password' >/dev/null; then
  echo "ðŸš¨ Possible secret detected in staged files. Please remove it before committing!"
  exit 1
fi

quotes=(
  "Commit messages are love letters to your future self."
  "Don't push broken code. Tests are your friends."
  "Keep calm and write clean code."
  "You aren't paid to write code. You're paid to add value."
  "Code is like humor. When you have to explain it, it's bad."
  "A good commit message is like a good book title: it tells you what to expect."
  "Commit early, commit often, and commit with purpose."
  "Your code is a reflection of you. Make it shine!"
  "In the world of code, simplicity is the ultimate sophistication."
)
random_index=$((RANDOM % ${#quotes[@]}))
echo "ðŸ’¡ ${quotes[$random_index]}"

echo "ðŸ§ª Step 1/2: Running tests..."
npm test || { echo "ðŸ›‘ Tests failed. Fix them before committing."; exit 1; }

echo "ðŸŽ¨ Step 2/2: Running lint-staged..."
npx lint-staged || { echo "ðŸ›‘ Linting failed. Fix it before committing."; exit 1; }

echo ""
echo "âœ… Pre-commit checks passed. You're cleared for liftoff! ðŸš€"
